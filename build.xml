<?xml version="1.0"?>

<project name="JNAPCSC" default="compile" basedir=".">

<echo message="pulling in property files"/>
<property file="build.properties"/>

<property name="src.dir" value="src/java"/>
<property name="test.dir" value="test/java"/>
<property name="tmp.dir" value="tmp"/>
<property name="build.dir" value="build"/>
<property name="classes.dir" value="build/classes"/>
<property name="assemble.dir" value="build/assemble"/>
<property name="dist.dir" value="dist"/>
<property name="doc.dir" value="doc"/>
<property name="lib.dir" value="lib"/>


<!-- CLASSPATH  -->

 <path id="classpath.path">
   <fileset dir="lib">
     <include name="**/*.jar"/>
   </fileset>
   <pathelement location="${classes.dir}"/>
 </path>



<target name="prepare">
	<mkdir dir="${classes.dir}"/>
	<mkdir dir="${dist.dir}"/>
	<mkdir dir="${doc.dir}"/>
</target>

<target name="clean">
	<delete dir="${build.dir}"/>
	<delete dir="${tmp.dir}"/>
	<delete>
		<!-- reports generated by ant junit -->
		<fileset dir="." includes="TEST-*.txt"/>
	</delete>
</target>

<target name="dist_clean" depends="clean">
	<delete dir="${dist.dir}"/>
	<delete dir="${doc.dir}"/>
</target>

<target name="compile" depends="prepare">
	<javac  srcdir="${src.dir}" 
          destdir="${classes.dir}" 
          classpathref="classpath.path"/>
</target>

<target name="compile_test" depends="compile">
	<javac  srcdir="${test.dir}" 
          destdir="${classes.dir}" 
          classpathref="classpath.path"/>
</target>


<target name="jar" depends="compile">
	<copy todir="${assemble.dir}">
		<fileset dir="${classes.dir}"/>
	</copy>
	<jar basedir="${assemble.dir}" destfile="${dist.dir}/${ant.project.name}.jar"/>
</target>

<target name="run" depends="jar">
	<echo message="Trying to run when I can't even walk ..."/>
	<java classname="de.kuriositaet.pcsc.Card">
		<classpath>
			<pathelement location="${dist.dir}/${ant.project.name}.jar"/>
			<path refid="classpath.path"/>
		</classpath>
	</java>
	
</target>

<target name="doc">
	<javadoc sourcepath="${src.dir}" 
					 destdir="${doc.dir}"  
					 classpath="${classpath}" 
					 Overview="overview.html"
					 access="package">
		<classpath>
			<path refid="classpath.path"/>
		</classpath>

	</javadoc>
</target>

<target name="test" depends="compile_test">
	<junit  fork="yes" printsummary="yes">
	  <formatter type="plain"/>
		<classpath>
			<path refid="classpath.path"/>
		</classpath>

		<test name="de.kuriositaet.pcsc.test.TestContext"/>
		<test name="de.kuriositaet.pcsc.test.TestPCSC_FFI"/>
		<test name="de.kuriositaet.pcsc.test.TestAPDU"/>
		<test name="de.kuriositaet.pcsc.test.UtilTest"/>	
	</junit>
</target>

</project>
